{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\David\\\\Documents\\\\asq-gui-js\\\\src\\\\components\\\\login.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { useLocation } from \"react-router-dom\";\nimport { useApi } from \"../api\";\n\n/*==========================================================\r\n * RequireLogin component:\r\n *   Only shows children if we have a log-in for the API\r\n */\nimport { Fragment as _Fragment, jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function RequireLogin({\n  children\n}) {\n  _s();\n  const api = useApi();\n  if (api.loggedIn) {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: children\n    }, void 0, false);\n  } else {\n    return /*#__PURE__*/_jsxDEV(Login, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 16,\n      columnNumber: 12\n    }, this);\n  }\n}\n\n/*==========================================================\r\n * Login component:\r\n *   Shows log-in page with link to Google\r\n */\n\n// helper function\n_s(RequireLogin, \"JrT4+2NswhoWmeifml0TF7ey2qk=\", false, function () {\n  return [useApi];\n});\n_c = RequireLogin;\nfunction addParams(params, values) {\n  for (const key in values) {\n    params.set(key, values[key]);\n  }\n}\nexport function Login() {\n  _s2();\n  let location = useLocation();\n  let params = new URLSearchParams(location.search.substring(1));\n  let error = params.get('error');\n\n  // Use to avoid CSRF and replay attacks\n  // Google includes this the ID token as well\n  let nonce = crypto.randomUUID();\n  sessionStorage.setItem('nonce', nonce);\n  const href = new URL('https://accounts.google.com/o/oauth2/v2/auth');\n  addParams(href.searchParams, {\n    client_id: '923167133428-nfsjgjq82p4gqqoca5htfqgslmbi6uv9.apps.googleusercontent.com',\n    redirect_uri: 'http://localhost:3000/asq/auth',\n    response_type: 'id_token',\n    scope: 'openid email profile',\n    state: nonce + location.pathname,\n    nonce: crypto.randomUUID()\n  });\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"Log-in Required\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 7\n    }, this), error && /*#__PURE__*/_jsxDEV(\"p\", {\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 55,\n      columnNumber: 18\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [/*#__PURE__*/_jsxDEV(\"a\", {\n        href: href.toString(),\n        children: \"Click here\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 57,\n        columnNumber: 9\n      }, this), \" to log in with Google.\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n_s2(Login, \"pkHmaVRPskBaU4tMJuJJpV42k1I=\", false, function () {\n  return [useLocation];\n});\n_c2 = Login;\nvar _c, _c2;\n$RefreshReg$(_c, \"RequireLogin\");\n$RefreshReg$(_c2, \"Login\");","map":{"version":3,"names":["useLocation","useApi","Fragment","_Fragment","jsxDEV","_jsxDEV","RequireLogin","children","_s","api","loggedIn","Login","fileName","_jsxFileName","lineNumber","columnNumber","_c","addParams","params","values","key","set","_s2","location","URLSearchParams","search","substring","error","get","nonce","crypto","randomUUID","sessionStorage","setItem","href","URL","searchParams","client_id","redirect_uri","response_type","scope","state","pathname","toString","_c2","$RefreshReg$"],"sources":["C:/Users/David/Documents/asq-gui-js/src/components/login.jsx"],"sourcesContent":["import { useLocation } from \"react-router-dom\";\r\nimport { useApi } from \"../api\";\r\n\r\n/*==========================================================\r\n * RequireLogin component:\r\n *   Only shows children if we have a log-in for the API\r\n */\r\n\r\nexport default function RequireLogin({ children }) {\r\n  const api = useApi();\r\n\r\n  if (api.loggedIn) {\r\n    return <>{children}</>\r\n  }\r\n  else {\r\n    return <Login />\r\n  }\r\n}\r\n\r\n/*==========================================================\r\n * Login component:\r\n *   Shows log-in page with link to Google\r\n */\r\n\r\n// helper function\r\nfunction addParams(params, values) {\r\n  for (const key in values) {\r\n    params.set(key, values[key]);\r\n  }\r\n}\r\n\r\nexport function Login() {\r\n  let location = useLocation();\r\n  let params = new URLSearchParams(location.search.substring(1));\r\n  let error = params.get('error');\r\n\r\n  // Use to avoid CSRF and replay attacks\r\n  // Google includes this the ID token as well\r\n  let nonce = crypto.randomUUID();\r\n  sessionStorage.setItem('nonce', nonce);\r\n\r\n  const href = new URL('https://accounts.google.com/o/oauth2/v2/auth');\r\n  addParams(href.searchParams, {\r\n    client_id: '923167133428-nfsjgjq82p4gqqoca5htfqgslmbi6uv9.apps.googleusercontent.com',\r\n    redirect_uri: 'http://localhost:3000/asq/auth',\r\n    response_type: 'id_token',\r\n    scope: 'openid email profile',\r\n    state: nonce + location.pathname,\r\n    nonce: crypto.randomUUID(),\r\n  });\r\n\r\n  return (\r\n    <>\r\n      <h1>Log-in Required</h1>\r\n      { error && <p>{error}</p> }\r\n      <p>\r\n        <a href={href.toString()}>Click here</a> to log in with Google.\r\n      </p>\r\n    </>\r\n  )\r\n}\r\n"],"mappings":";;;AAAA,SAASA,WAAW,QAAQ,kBAAkB;AAC9C,SAASC,MAAM,QAAQ,QAAQ;;AAE/B;AACA;AACA;AACA;AAHA,SAAAC,QAAA,IAAAC,SAAA,EAAAC,MAAA,IAAAC,OAAA;AAKA,eAAe,SAASC,YAAYA,CAAC;EAAEC;AAAS,CAAC,EAAE;EAAAC,EAAA;EACjD,MAAMC,GAAG,GAAGR,MAAM,CAAC,CAAC;EAEpB,IAAIQ,GAAG,CAACC,QAAQ,EAAE;IAChB,oBAAOL,OAAA,CAAAF,SAAA;MAAAI,QAAA,EAAGA;IAAQ,gBAAG,CAAC;EACxB,CAAC,MACI;IACH,oBAAOF,OAAA,CAACM,KAAK;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC;EAClB;AACF;;AAEA;AACA;AACA;AACA;;AAEA;AAAAP,EAAA,CAhBwBF,YAAY;EAAA,QACtBL,MAAM;AAAA;AAAAe,EAAA,GADIV,YAAY;AAiBpC,SAASW,SAASA,CAACC,MAAM,EAAEC,MAAM,EAAE;EACjC,KAAK,MAAMC,GAAG,IAAID,MAAM,EAAE;IACxBD,MAAM,CAACG,GAAG,CAACD,GAAG,EAAED,MAAM,CAACC,GAAG,CAAC,CAAC;EAC9B;AACF;AAEA,OAAO,SAAST,KAAKA,CAAA,EAAG;EAAAW,GAAA;EACtB,IAAIC,QAAQ,GAAGvB,WAAW,CAAC,CAAC;EAC5B,IAAIkB,MAAM,GAAG,IAAIM,eAAe,CAACD,QAAQ,CAACE,MAAM,CAACC,SAAS,CAAC,CAAC,CAAC,CAAC;EAC9D,IAAIC,KAAK,GAAGT,MAAM,CAACU,GAAG,CAAC,OAAO,CAAC;;EAE/B;EACA;EACA,IAAIC,KAAK,GAAGC,MAAM,CAACC,UAAU,CAAC,CAAC;EAC/BC,cAAc,CAACC,OAAO,CAAC,OAAO,EAAEJ,KAAK,CAAC;EAEtC,MAAMK,IAAI,GAAG,IAAIC,GAAG,CAAC,8CAA8C,CAAC;EACpElB,SAAS,CAACiB,IAAI,CAACE,YAAY,EAAE;IAC3BC,SAAS,EAAE,0EAA0E;IACrFC,YAAY,EAAE,gCAAgC;IAC9CC,aAAa,EAAE,UAAU;IACzBC,KAAK,EAAE,sBAAsB;IAC7BC,KAAK,EAAEZ,KAAK,GAAGN,QAAQ,CAACmB,QAAQ;IAChCb,KAAK,EAAEC,MAAM,CAACC,UAAU,CAAC;EAC3B,CAAC,CAAC;EAEF,oBACE1B,OAAA,CAAAF,SAAA;IAAAI,QAAA,gBACEF,OAAA;MAAAE,QAAA,EAAI;IAAe;MAAAK,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAI,CAAC,EACtBY,KAAK,iBAAItB,OAAA;MAAAE,QAAA,EAAIoB;IAAK;MAAAf,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAI,CAAC,eACzBV,OAAA;MAAAE,QAAA,gBACEF,OAAA;QAAG6B,IAAI,EAAEA,IAAI,CAACS,QAAQ,CAAC,CAAE;QAAApC,QAAA,EAAC;MAAU;QAAAK,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAG,CAAC,2BAC1C;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAG,CAAC;EAAA,eACJ,CAAC;AAEP;AAACO,GAAA,CA7BeX,KAAK;EAAA,QACJX,WAAW;AAAA;AAAA4C,GAAA,GADZjC,KAAK;AAAA,IAAAK,EAAA,EAAA4B,GAAA;AAAAC,YAAA,CAAA7B,EAAA;AAAA6B,YAAA,CAAAD,GAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}